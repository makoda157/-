<!DOCTYPE html>
<html class="h-100"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head th:replace="common/header :: head_fragment(title=日報詳細)"></head>
<body class="h-100 overflow-hidden">
<div class="row h-100">
  <div class="h-100 p-3 mb-2 bg-dark text-white col-sm-2">
    <nav th:replace="common/side :: copy"></nav>
  </div>
  <div class="mt-3 h-100 col-sm-10">

    <div class="container-fluid p-0">
      <h1 class="h3 mb-3">日報 詳細</h1>
    </div>

    <div class="mb-3 col-12 col-xxl-6">
      <div class="col-xl-12">
        <div class="card">
          <div class="card-body mb-5">

            <!-- 画面内エラー表示（必要時） -->
            <div th:if="${deleteError}" class="alert alert-danger" th:text="${deleteError}"></div>
            <div th:if="${authorityError}" class="alert alert-danger" th:text="${authorityError}"></div>
            <div th:if="${detailError}" class="alert alert-danger" th:text="${detailError}"></div>

            <table class="table table-striped">
              <tr>
                <th class="w-25">日付</th>
                <td class="align-middle" th:text="${#temporals.format(report.reportDate, 'yyyy-MM-dd')}"></td>
              </tr>
              <tr>
                <th>氏名</th>
                <td class="align-middle" th:text="${report.employee.name}"></td>
              </tr>
              <tr>
                <th>タイトル</th>
                <td class="align-middle" th:text="${report.title}"></td>
              </tr>
              <tr>
                <th>内容</th>
                <td class="align-middle">
                  <pre class="mb-0" style="white-space: pre-wrap;" th:text="${report.content}"></pre>
                </td>
              </tr>
              <tr>
                <th>登録日時</th>
                <td class="align-middle" th:text="${#temporals.format(report.createdAt, 'yyyy-MM-dd HH:mm:ss')}"></td>
              </tr>
              <tr>
                <th>更新日時</th>
                <td class="align-middle" th:text="${#temporals.format(report.updatedAt, 'yyyy-MM-dd HH:mm:ss')}"></td>
              </tr>
            </table>

            <div class="mt-5 row g-1">
              <!-- 更新：管理者 -->
              <div class="col-auto" sec:authorize="hasAuthority('ADMIN')">
                <a th:href="@{/reports/{id}/update(id=${report.id})}" class="btn btn-primary">更新</a>
              </div>
              <!-- 更新：本人（一般権限） -->
              <div class="col-auto" sec:authorize="!hasAuthority('ADMIN')"
                   th:if="${#authentication.principal.employee.code == report.employee.code}">
                <a th:href="@{/reports/{id}/update(id=${report.id})}" class="btn btn-primary">更新</a>
              </div>

              <!-- 削除：管理者 -->
              <div class="col-auto" sec:authorize="hasAuthority('ADMIN')">
                <form th:action="@{/reports/{id}/delete(id=${report.id})}" method="post"
                      onsubmit="if(!window.confirm('本当に削除しますか？')){ event.preventDefault(); }">
                  <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                  <button type="submit" class="btn btn-primary">削除</button>
                </form>
              </div>
              <!-- 削除：本人（一般権限） -->
              <div class="col-auto" sec:authorize="!hasAuthority('ADMIN')"
                   th:if="${#authentication.principal.employee.code == report.employee.code}">
                <form th:action="@{/reports/{id}/delete(id=${report.id})}" method="post"
                      onsubmit="if(!window.confirm('本当に削除しますか？')){ event.preventDefault(); }">
                  <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">
                  <button type="submit" class="btn btn-primary">削除</button>
                </form>
              </div>

              <!-- 戻る -->
              <div class="col-auto">
                <a th:href="@{/reports}" class="btn btn-primary">戻る</a>
              </div>
            </div>

          </div>
        </div>
      </div>
    </div>

  </div>
</div>
</body>
</html>
